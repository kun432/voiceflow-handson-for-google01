
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Voiceflowハンズオン Google Home編 Vol.1</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="dist"
                  title="Voiceflowハンズオン Google Home編 Vol.1"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="概要" duration="0">
        <h2 is-upgraded>はじめに</h2>
<p class="image-container"><img alt="logo" src="img/ff48bd2d70a67aa0.png"></p>
<p>Voiceflowを使った、ノンコーディングで始めるGoogle Home向けアクション開発のハンズオン資料です。</p>
<h2 is-upgraded>想定するターゲット</h2>
<ul>
<li>スマートスピーカーアプリ開発に興味のある方</li>
<li>Google Homeをお持ちの方</li>
<li>プログラミングをやったことがない方</li>
<li>とりあえず始めてみたい方</li>
</ul>
<h2 is-upgraded>注意</h2>
<aside class="warning"><p><strong>まだ作成途中です！今後内容が変わる可能性がありますのでご注意ください。</strong></p>
</aside>
<aside class="warning"><p>本手順書は2019年9月7日時点のものですが、Voiceflowの開発はかなり活発なので、本手順書通りに進めてもうまくいかない場合や画面が変更されている場合があります。</p>
</aside>
<aside class="warning"><p>Voiceflowは、一部日本語がうまく扱えないところがあります。そのため、回避策的なやり方で進める場合がありますが、ご了承ください。そのうち改善されるかもしれません。</p>
</aside>
<aside class="warning"><p>現時点（2019年9月7日）で、VoiceflowはAlexa向けの機能の方が多いです。Google Homeのサポートはまだまだ発展途中だということを予めご了承ください。</p>
</aside>
<aside class="special"><p>不具合やお気づきの点があれば、<a href="https://github.com/kun432/voiceflow-handson-for-google01/issues" target="_blank">https://github.com/kun432/voiceflow-handson-for-google01/issues</a>でissue立てていただければと思います。PRも歓迎！</p>
</aside>
<aside class="special"><p>もしくはkun432.8d1w@gmail.comまで</p>
</aside>
<h2 is-upgraded>更新履歴</h2>
<ul>
<li>2019/09/07    初版</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="事前準備" duration="0">
        <h2 is-upgraded>必要なもの</h2>
<p>以下を事前に準備しておいてください。</p>
<h3 is-upgraded>gmailアカウント</h3>
<p>以下で使用します。事前に準備しておいてください。</p>
<ul>
<li>Voiceflowへのログイン</li>
<li>Actions on Google / Dialogflow / Google Cloud Platformへのログイン</li>
<li>Googleスプレッドシートへのログイン</li>
</ul>
<h2 is-upgraded>では始めましょう！</h2>


      </google-codelab-step>
    
      <google-codelab-step label="Voiceflowアカウントの作成とログイン" duration="0">
        <h2 is-upgraded>Voiceflowアカウントの作成</h2>
<p><a href="https://voiceflow.com/" target="_blank">https://voiceflow.com/</a>にアクセスします。Voiceflowアカウントを持っていない方は、&#34;Sign up free&#34;をクリックしてアカウントを作成しましょう。<br>※すでにアカウントを持っている方は、これ以降の作業は不要です。&#34;Sign in&#34;をクリックしてログインし、次の章に進みましょう。</p>
<p class="image-container"><img alt="s000" src="img/92009daee52ef5c8.png"></p>
<p>&#34;Sign up with Google&#34; をクリックします。</p>
<p class="image-container"><img alt="s001" src="img/aebfa22299830035.png"></p>
<p>gmailのログイン画面が出てきたらログインします。</p>
<p class="image-container"><img alt="s002" src="img/e1e358a35093dc31.png"></p>
<p>登録後にかんたんなアンケートがありますので、順に答えていきましょう。なお、どれを選択したとしてもVoiceflowの利用に影響はありませんので安心してください。&#34;Continue&#34;をクリックして進めます。</p>
<p class="image-container"><img alt="s003" src="img/d55c64077fcd3b21.png"></p>
<p>Voiceflowを使う目的（個人利用か、仕事か）を聞いてくるので、適当に選んでください。選んだら、&#34;Continue&#34;をクリックします。</p>
<p class="image-container"><img alt="s004" src="img/54c7c9f36e6cdd8f.png"></p>
<p>Voiceflowをどういうふうに使うのか（デザインやプロトタイピング、開発やリリース）を聞いてくるので、適当に選んでください。選んだら、&#34;Continue&#34;をクリックします。</p>
<p class="image-container"><img alt="s005" src="img/329fb5ab2fb13c8a.png"></p>
<p>プログラミング経験があるか？を聞いてくるので、適当に選んでください。（経験なし、少しだけ経験あり、経験豊富）。選んだら、&#34;Complete&#34;をクリックします。</p>
<p class="image-container"><img alt="s006" src="img/748a2f23291a9011.png"></p>
<p>以下の画面が出てきたらログイン完了です！ちなみに動画の方はVoiceflowのCEOであるBradenさんです。&#34;Get started&#34;をクリックします。</p>
<p class="image-container"><img alt="s007" src="img/13e00a5e3086295c.png"></p>
<p>&#34;My First Project&#34; という最初のプロジェクトが開いた状態になっていますが、これは使いません。左上の&#34;＜&#34;をクリックします。</p>
<p class="image-container"><img alt="s008" src="img/44f50dfde092d1e4.png"></p>
<p>プロジェクトの一覧画面が表示されます。Voiceflowでは、AlexaスキルやGoogle Homeアクションを「プロジェクト」という単位で管理します。右の列にあるのがさっき開いていた、アカウント作成と同時に最初に自動作成される「My First Project」ですね。左の列にはサンプルのプロジェクトが並んでいます。</p>
<p>このハンズオンでは、この一覧画面でプロジェクトの新規作成から行いますので、これらのプロジェクトはすべて使用しません。プロジェクトを作成するとこの画面に一覧表示される、と思ってもらえればよいです。</p>
<p class="image-container"><img alt="s009" src="img/6b84e0ee687b8ce9.png"></p>
<aside class="special"><p>元々用意されているプロジェクトは、不要であれば削除してもかまいません。特に&#34;My First Project&#34;については、このあとプロジェクトの新規作成を行いますので、削除しても問題ないです。</p>
</aside>
<aside class="special"><p>サンプルプロジェクトは、アクションの作り方の参考になると思いますので、興味があれば中身を見てみてください。</p>
</aside>
<aside class="warning"><p>ただし、これらのサンプルはlexaスキル向けとなっていますので、そのままではGoogle Home向けには動作しない可能性があります。あくまでも参考と考えていただければと思います。</p>
</aside>
<aside class="warning"><p>削除したプロジェクトは復旧できませんので、ご注意ください。</p>
</aside>
<p>これで準備が整いました。いよいよ次の章からGoogle Home向けのアクションを作っていきます！</p>
<h2 is-upgraded>おまけ：右下のアイコンは何？</h2>
<p>ところで、右下にあるこのアイコン、ずっと表示されていますけど、気になりますね。クリックするとどうなるでしょうか？</p>
<p class="image-container"><img alt="s010" src="img/cca494b938650705.png"></p>
<p>下からメニューが表示されました。これがVoiceflowのヘルプツールです。チャットサポートに問い合わせしたり、ドキュメントを検索したり、Voiceflowの稼働状況などを知ることができます。わからないこととかはここから問い合わせり調べればいいというわけですね。ただし英語です・・・</p>
<p class="image-container"><img alt="s011" src="img/92578594d79ae674.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="アクションの作成（STEP1）" duration="0">
        <h2 is-upgraded>今回作成するサンプルアクションについて</h2>
<p>今回のハンズオンでサンプルとして作成するアクションの動作イメージは以下のようなものです。</p>
<p class="image-container"><img alt="s011-2" src="img/c4b628a5a0fa113f.png"></p>
<ul>
<li>ユーザが飲み物を注文します。</li>
<li>ユーザは１回の注文で、１つの飲み物しか指定できないこととします.</li>
<li>注文できる飲み物は、オレンジジュース、ミックスジュース、アップルジュースの３種類とします。</li>
<li>ユーザの注文内容に応じて、Google Homeからの回答を変えます。</li>
<li>ユーザの言い方はさまざまなので複数の言い方に対応できるようにします。</li>
</ul>
<p>シンプルですね！</p>
<h2 is-upgraded>プロジェクトの新規作成</h2>
<p>では早速プロジェクトを作っていきましょう。&#34;Default List&#34; の下にある&#34;Create Project&#34;をクリックします。</p>
<p class="image-container"><img alt="s012" src="img/d703988a343ce1aa.png"></p>
<p>新規プロジェクトの作成画面が開きます。以下を入力します。</p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>入力内容</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>Enter your project name</em></p>
</td><td colspan="1" rowspan="1"><p>プロジェクト名を入れます。&#34;フルーツパーラー&#34;と入力します。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>Select Region</em></p>
</td><td colspan="1" rowspan="1"><p>言語を選択します。&#34;Japanese(JP)&#34;にチェックを入れて、&#34;English(US)&#34;のチェックを外します。</p>
</td></tr>
</table>
<aside class="warning"><p>Voiceflowでプロジェクトを作成すると、デフォルトはAlexa向けプロジェクトとなり、ここで設定する言語設定はAlexa向けのものとなります。Google Home向けプロジェクトでは別途言語設定が必要になりますので、ご注意ください。</p>
</aside>
<p>入力したら、&#34;Create Project&#34;をクリックします。</p>
<p class="image-container"><img alt="s013" src="img/e211fa4dc4167229.png"></p>
<p>以下の画面が表示されればOKです。</p>
<p class="image-container"><img alt="s014" src="img/47eaa739536ef9c3.png"></p>
<h2 is-upgraded>画面の構成</h2>
<p>最初に画面の構成について説明します。</p>
<p class="image-container"><img alt="s015" src="img/e2b36ae7ceda0de8.png"></p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>入力内容</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>Blocksメニュー</em></p>
</td><td colspan="1" rowspan="1"><p>機能ごとに分けられたブロックが並んでいます。使いたいブロックをここから選びます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>Canvas（キャンバス）</em></p>
</td><td colspan="1" rowspan="1"><p>Blocksメニューから選んだブロックをここに配置し、線でつなげていくことで会話フローを作っていきます。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>Home Block</em></p>
</td><td colspan="1" rowspan="1"><p>最初から用意されているのがブロックです。ここから会話フローがスタートし、他のブロックにつなげていきます。なお、Home Blockは削除することはできません。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>アップロードボタン</em></p>
</td><td colspan="1" rowspan="1"><p>作成したプロジェクトをAlexa／Google Homeそれぞれのプラットフォームにアップロードします。アップロードすることでAmazon EchoやGoogle Homeなどのスマートスピーカデバイスから利用可能となります。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>Alexa/Google切り替えスイッチ</em></p>
</td><td colspan="1" rowspan="1"><p>作成したプロジェクトをAlexa向け／Google Home向けに切り替えます。デフォルトはAlexaになっています。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>メニュー切り替え</em></p>
</td><td colspan="1" rowspan="1"><p>メニューの切り替えを行います。選択できるメニューには、Blocksメニュー/Flowsメニュー/Variablesメニューがあります。ハンズオンの後半で説明します。</p>
</td></tr>
</table>
<p>細かいことは実際に使いながら覚えていきましょう。</p>
<h2 is-upgraded>AlexaからGoogleへの切り替え</h2>
<p>プロジェクト新規作成直後は、Alexa向けがデフォルトになっています。今回はGoogle Home向けのプロジェクトなので、最初にAlexaからGoogleに切り替えを行います。</p>
<p>中央の一番上にあるAlexa/Google切り替えスイッチをクリックしてください。</p>
<p class="image-container"><img alt="s015-2" src="img/9f7a4ac60d41fe76.png"></p>
<p>スイッチがGoogleにかわり、右のアップロードボタンが &#34;Upload to Alexa&#34; から &#34;Upload to Google&#34; に変わればOKです。</p>
<p class="image-container"><img alt="s015-3" src="img/da2479fc6c619ae2.png"></p>
<aside class="warning"><p>現時点（2019年9月7日）で、VoiceflowはAlexa向けの機能の方が多いです。Google Homeのサポートはまだまだ発展途中だということを予めご了承ください。</p>
</aside>
<aside class="warning"><p>AlexaとGoogleの切り替えはいつでも行えますが、切り替えるだけで完全に動作するわけではなく、多数修正が必要になるということを予めご了承ください。現実的な対応としては、どちらかのプラットフォーム向けに作り込んだあとで、プロジェクトをコピーして、もう片方向けに修正していく、つまり、それぞれのプラットフォーム向けで別々のプロジェクトとして管理するのが一般的だと思います。</p>
</aside>
<h2 is-upgraded>言語の設定</h2>
<p>プロジェクト新規作成時に設定した言語はAlexa向けのものとなっていますので、Google Home向けにも、別途言語設定を行います。左上のプロジェクト名の少し下にある&#34;Publish&#34;をクリックします。</p>
<p class="image-container"><img alt="s015-4" src="img/1a7c1a14038a29da.png"></p>
<p>言語設定画面が開きます。デフォルトでは、&#34;English(En)&#34;が選択されていますので、&#34;Japanese(Ja)&#34;をクリックします。</p>
<p class="image-container"><img alt="s015-5" src="img/a699bf3186fbb20e.png"></p>
<p>&#34;Japanese(Ja)&#34;に切り替わりました。これで言語設定は完了です。左上の&#34;Build&#34;をクリックしてCanvas画面に戻ります。</p>
<p class="image-container"><img alt="s015-6" src="img/47cfaf19b5f872a1.png"></p>
<h2 is-upgraded>ブロックの配置</h2>
<p>では早速やっていきましょう。最初にGoogle Homeから話をさせてみましょう。Google Homeから話をさせるにはSpeak Blockを使います。左のBlockメニューからSpeak Blockをドラッグ＆ドロップで以下のように配置してください。</p>
<p class="image-container"><img alt="s016" src="img/d606d305a125304e.png"></p>
<p>右のテキストボックスにGoogle Homeに話させる文章を入力します。以下の文章を入力してください。（コピペしてOKですよ！）</p>
<pre><code>フルーツパーラーへようこそ。ご注文をどうぞ。
</code></pre>
<p class="image-container"><img alt="s017" src="img/c688d8a73a42d505.png"></p>
<p>Home BlockのStartの右端のグレーの四角からドラッグすると線がひけますので、今配置したSpeak Blockの左橋のグレーの四角につなげます。</p>
<p class="image-container"><img alt="s018" src="img/d70dfb36f33d43ff.png"></p>
<p>これで会話フローが繋がりました。このように様々なブロックを並べて、設定をして、線で順につなげていくことで会話フローを作るのがVoiceflowの基本操作になります。かんたんですね！</p>
<h2 is-upgraded>アップロードとGoogle Home向け連携設定（各プロジェクトの初回のみ）</h2>
<p>では、早速アップロードして動作するかを確認してみましょう。各プロジェクトの初回アップロード時だけはいろいろ設定の手間がかかるのですが、頑張ってついてきてください！</p>
<p>&#34;Upload to Google&#34;ボタンをクリックします。</p>
<p class="image-container"><img alt="s019" src="img/d1dd9c1b2c91b8e3.png"></p>
<p>Voiceflow から Actions on Google（Googleアシスタントの基本的な管理）へのアクセスに必要な認証トークンを取得します。&#34;Login with Google&#34; をクリックします。</p>
<p class="image-container"><img alt="s020" src="img/829a6be35babde30.png"></p>
<p>Googleログイン画面が表示されますので、Voiceflowアカウントと同じGoogleアカウントを選択してログインしてください。</p>
<p class="image-container"><img alt="s021" src="img/e088f0a4374f8c6c.png"></p>
<p>アクセス権の許可を求められるので「許可」をクリックします。</p>
<p class="image-container"><img alt="s022" src="img/fcfbd1cd3e941f2f.png"></p>
<p>認証トークンが画面に表示されます。右端のコピーアイコンをクリックして、クリップボードにコピーします。</p>
<p class="image-container"><img alt="s023" src="img/9ea98656757bbdf.png"></p>
<p>Voiceflowの画面に戻って、&#34;Paste code here&#34;に先程の認証トークンをペーストし、&#34;Verify&#34; をクリックします。</p>
<p class="image-container"><img alt="s024" src="img/a86c4b837cc77544.png"></p>
<p>認証に成功すると、次に、Actions on GoogleとDialogFlow(Googleアシスタントの会話部分やバックエンド処理を行う部分、Actions on Googleから処理が渡される) との連携を行います。少しややこしいのですが、最初だけなので頑張りましょう！</p>
<p>&#34;here&#34; か &#34;Setup tutorial&#34; をクリックします。</p>
<p class="image-container"><img alt="s025" src="img/404b201113e1c26f.png"></p>
<p>Voiceflowの<a href="https://learn.voiceflow.com/en/articles/2705386-uploading-your-project-to-google-assistant" target="_blank">Google Home向けセットアップのチュートリアル</a>が開きます。基本的にここに書いてある通りに実施していけばよいのですが、すべて英語で書いてあって辛いと思いますので、ここから日本語で説明していきます！</p>
<p class="image-container"><img alt="s026" src="img/6529c4f08b98cbe3.png"></p>
<p>Actions on Google のURL、<a href="https://developers.google.com/actions/" target="_blank">https://developers.google.com/actions/</a> にアクセスします。以下のような画面が表示されるはずです。</p>
<p class="image-container"><img alt="s027" src="img/cb8276f946fc1314.png"></p>
<p>このとき、右上にログインしているgmailアカウントが表示されます。このアカウントが先程認証トークンを取得する際にログインしたアカウントと同じであることを確認してください。もし違うアカウントになっていれば、切り替えるか、ログインし直してください。</p>
<p class="image-container"><img alt="s028" src="img/7f05b76e04ecf1c6.png"></p>
<aside class="special"><p>本ハンズオンでは、Voiceflowのログインで使用したgmailアカウントを、Actions on GoogleやDialogFlowでも共通で使うことを想定していますので、ここまですべて同じ一つのgmailアカウントを使用しているはずです。</p>
</aside>
<aside class="warning"><p>ただし、本ハンズオン用に、普段お使いのgmailアカウントとは別のアカウントをご用意された場合、Actions on GoogleやDialogFlowへのログイン時に、「気づかず」普段のアカウントが選択されている場合がありますのでご注意ください。(その場合、アップロードに失敗する可能性がありますのでご注意ください)</p>
</aside>
<p>認証トークン取得に使用したgmailアカウントが選択されていることを確認したら、&#34;GO TO ACTIONS CONSOLE&#34;をクリックします。</p>
<p class="image-container"><img alt="s029" src="img/26a104b919dfc498.png"></p>
<p>Actions on Googleの管理画面、「Actions Console」が開きます。まず、Actions Consoleでプロジェクトを作成します。&#34;New Project&#34;をクリックします。</p>
<p class="image-container"><img alt="s030" src="img/dc053a29effa35e3.png"></p>
<p>利用規約に同意するかを聞かれます。一番上は、規約に同意するか？なので必ず&#34;Yes&#34;を選択、Country of residence は &#34;Japan&#34; が選択されていることを確認してください。下の2つはお知らせやアンケートの送信に関する許諾なので、どっちでもよいです。同意してすすめるならば&#34;Agree and continue&#34;をクリックします。</p>
<p class="image-container"><img alt="s031" src="img/5dc8ecf7dcb6f69a.png"></p>
<p>新しいプロジェクトの作成画面が開きますので、以下の通り設定します。</p>
<table>
<tr></tr>
<tr><td colspan="1" rowspan="1"><p><strong>項目</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>入力内容</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>project name</em></p>
</td><td colspan="1" rowspan="1"><p>プロジェクト名を入れます。アルファベット、数字、一部の記号のみになります。日本語は入力できませんのでご注意ください。今回は&#34;fruits-parlor&#34;と入力します。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>Choose a language for ・・・</em></p>
</td><td colspan="1" rowspan="1"><p>言語を選択します。&#34;Japanese&#34;を選択します。</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><em>Choose your country or region</em></p>
</td><td colspan="1" rowspan="1"><p>国を選択します。&#34;Japan&#34;を選択します。</p>
</td></tr>
</table>
<p>設定が終わったら、&#34;Create Project&#34;をクリックします。</p>
<p class="image-container"><img alt="s032" src="img/67d1e11852d00249.png"></p>
<p>次にプロジェクトのテンプレートを選択する画面が表示されます。VoiceflowでDialogFlowを使った会話アクションを作成する場合は、一番右下の&#34;Conversational&#34;をクリックします。</p>
<aside class="warning"><p>Voiceflowでは&#34;Conversational&#34;以外は動作しません。</p>
</aside>
<p class="image-container"><img alt="s033" src="img/6d1913b17ef8d6a7.png"></p>
<p>以下のような画面が表示されればActions on Google上でプロジェクト作成は完了しています。</p>
<p class="image-container"><img alt="s034" src="img/8c08d47d8bb263c2.png"></p>
<p>ここからDialogFlowとの連携設定を行っていきます。&#34;Build your Action&#34;をクリックします。</p>
<p class="image-container"><img alt="s035" src="img/c7aa825cd75b949c.png"></p>
<p>&#34;Build your Action&#34;のメニューの中の&#34;Add Actions&#34;をクリックします。</p>
<p class="image-container"><img alt="s036" src="img/dd18683f5ad75cd0.png"></p>
<p>&#34;Add your first action&#34;をクリックします。</p>
<p class="image-container"><img alt="s037" src="img/ae6733f8181bdf94.png"></p>
<p>作成するACTIONを選択する画面が出てきます。&#34;Custom Intent&#34;が選択されていることを確認し、&#34;BUILD&#34;をクリックします。</p>
<p class="image-container"><img alt="s038" src="img/a36e9e6acb27b0f3.png"></p>
<p>DialogFlowへのログイン画面が別タブで表示されます。先程まで使用してきたのと同じgmailアカウントを選択してログインします。</p>
<p class="image-container"><img alt="s039" src="img/fc88150587b39f9d.png"></p>
<p>アクセス権の許可を求められますので「許可」をクリックします。</p>
<p class="image-container"><img alt="s040" src="img/c7fa5d106bc28907.png"></p>
<p>DialogFlowの利用規約が表示されます。&#34;Country or territory&#34;に&#34;Japan&#34;が選択されていることを確認したら、&#34;Terms of Service&#34;のチェックボックスにチェックを入れて、&#34;Accept&#34;をクリックします。（Email preferencesの2つのチェックボックスは、お知らせやアンケートに関する許諾なのでどちらでもかまいません。）</p>
<p class="image-container"><img alt="s041" src="img/2f83dcadd4d87eb8.png"></p>
<p>Dialogflowの画面が表示されます。</p>
<p class="image-container"><img alt="s043" src="img/902bd497c3278010.png"></p>
<p>以下の点を「必ず」確認して下さい。</p>
<ul>
<li>Actions on Googleで設定したプロジェクト名が「自動」で設定されていること</li>
<li>GOOGLE PROJECTのところに&#34;Agent will be linked with 〜&#34; という記載で、Actions on Googleで作成したプロジェクト名が表示されていること</li>
</ul>
<p>上記が正しく設定されていれば、Actions on GoogleとDialogflowの連携が正しく設定されていますので、DEFAULT TIMEZONEが&#34;Asia/Tokyo&#34;となっていることを確認の上、DEFAULT LANGUAGE を &#34;Japanese - ja&#34;を選択して、&#34;CREATE&#34;をクリックします。</p>
<aside class="warning"><p>この2点が設定されていない、または、以下のようなDialogFlowのTOP画面が表示された場合、Actions on GoogleとDialogflowの連携が正しくできていない可能性があります。<br>【Actions on Googleの設定が正しく連携されていない】<br><img alt="s044" src="img/46f8418e1844bdda.png"><br>【DialogflowのTOPページが表示される】<br><img alt="s042" src="img/39a22828e0617738.png"><br>この場合は、Dialogflowのタブを閉じて、Actions on Googleのタブに戻り、&#34;Add yoru first action&#34;をクリックしてみてください。（再度ログインやアクセス権の許可が求められるかもしれませんが、そのまま進めれば正しく連携されると思います。）<br><img alt="s037" src="img/ae6733f8181bdf94.png"><br>それでも変わらない場合、Actions on Googleとは異なるgmailアカウントでログインしている可能性も考えられますので、一旦DialogFlowからログアウトしてみてください。</p>
</aside>
<p>Dialogflowで正しくアクションが作成されると以下のようになります。左上のプロジェクト名の横にある、歯車アイコンをクリックしてください。</p>
<p class="image-container"><img alt="s045" src="img/a932fc9305e71edb.png"></p>
<p>設定画面が表示されるので、&#34;Service Account&#34; に記載されているアカウントのリンクをクリックします。ここからはGoogle Cloud Platformでの操作となります。</p>
<p class="image-container"><img alt="s046" src="img/b75d9424e48ab805.png"></p>
<p>Google Cloud Platformに初めてログインされる場合は、利用規約への同意を求められますので、利用規約への同意にチェックを入れ、居住国に「日本」が選択されていることを確認の上、「同意して続行」をクリックします。</p>
<p class="image-container"><img alt="s047" src="img/680aa366103bab46.png"></p>
<aside class="warning"><p>Google Cloud Platformログイン時に「権限がない」というエラーが出る場合があります。その場合は、異なるgmailアカウントで既にGoogle Cloud Platformにログインしている可能性がありますので、これまで使用してきたgmailアカウントに切り替えてください。</p>
</aside>
<p>Google Cloud Platformの「IAMと管理」という管理画面が表示されたら、真ん中上部にある「＋ サービスアカウントを作成」をクリックします。</p>
<p class="image-container"><img alt="s048" src="img/af5d286c58f1b9c5.png"></p>
<p>「サービスアカウント名」に&#34;Voiceflow Creator Tool&#34;と入力し、「作成」をクリックします。</p>
<p class="image-container"><img alt="s049" src="img/eeadc02a95c57757.png"></p>
<p>次に「サービスアカウントの権限」を設定します。「役割を選択」をクリックして・・・</p>
<p class="image-container"><img alt="s050" src="img/faeeba0b108e81a9.png"></p>
<p>出てきたメニューの一番上で&#34;Dialog&#34;と入力すると表示される「Dialogflow API管理者」を選択します。</p>
<p class="image-container"><img alt="s051" src="img/bbc46ebd279add83.png"></p>
<p>&#34;続行&#34;をクリックします。</p>
<p class="image-container"><img alt="s052" src="img/2fa8497b30aa4db4.png"></p>
<p>以下の画面が表示されますので、「キーの作成」をクリックします、</p>
<p class="image-container"><img alt="s053" src="img/bcabe8d870795b45.png"></p>
<p>キー作成メニューが表示されるので、キーのタイプは「JSON」を選択して、「作成」をクリックします。</p>
<p class="image-container"><img alt="s054" src="img/6352d9a2bcdccf67.png"></p>
<p>キーファイルがダウンロードされます。これがVoiceflowとの連携に必要です。</p>
<aside class="warning"><p>キーファイルは安全な場所に保管するようにしてください。</p>
</aside>
<p class="image-container"><img alt="s055" src="img/44b9357f4b133af5.png"></p>
<p>サービスアカウント作成画面の一番下の「完了」をクリックします。</p>
<p class="image-container"><img alt="s056" src="img/5f44cd427c794dd2.png"></p>
<p>Voiceflowに戻り、先程取得したキーファイルをドラッグ＆ドロップでアップロードします。</p>
<p class="image-container"><img alt="s057" src="img/bdaccb07797ae56f.png"></p>
<p>&#34;Successfully Uploaded&#34; と表示されていればキーファイルが正しくアップロードされています。これでVoiceflowとGoogleの連携は完了です。ほんと、お疲れさまでした！</p>
<h2 is-upgraded>テスト</h2>
<p>では、いよいよアクションをアップロードして、Google側でテストします。&#34;Upload&#34;をクリックします。</p>
<p class="image-container"><img alt="s058" src="img/af76a17e8b3c4409.png"></p>
<p>アップロードが行われます。100%になるまで待ちます。</p>
<p class="image-container"><img alt="s059" src="img/6d5fe849987fb3b8.png"></p>
<p>&#34;Action Upload Successful&#34;と表示されれば、アップロードは完了しています！ &#34;Google Action Simulator&#34; をクリックします。</p>
<p class="image-container"><img alt="s060" src="img/bd06156e280c64d8.png"></p>
<p>別のタブでGoogleのシミュレータが起動します。初回起動時は以下のような画面が表示されますので、&#34;VERSION - Draft&#34;が選択されていることを確認して、&#34;Done&#34;をクリックします。</p>
<p class="image-container"><img alt="s061" src="img/2f809dbebf8e8bcd.png"></p>
<p>これがGoogleのシミュレータです。左が会話をテストするためのシミュレータになっていて、右側は、シミュレータの結果の詳細（スマホのGoogleアシスタントやNest Hubなど画面表示が可能なデバイスの場合の画面表示や、実際に行われているリクエストやレスポンスなど）を表示する場所になっています。</p>
<p class="image-container"><img alt="s062" src="img/4a13310ebd22e5de.png"></p>
<p>ではテストを行ってみましょう。左のシミュレータの一番下に、会話内容を入力するか、マイクをクリックして実際に発話することでテストが行なえます。</p>
<aside class="special"><p>なお、Googleの場合、標準では「テスト用アプリ」というアクション名になります。これは後で変更します。</p>
</aside>
<p>すでにアクションを起動するための発話が入力されているので、そのままENTERを押すか、マイクをクリックして実際にアクションを起動してみてください。</p>
<p class="image-container"><img alt="s063" src="img/696b9ba1d76e38dc.png"></p>
<p>最初にSpeak Blockに設定した文章が音声が流れましたか？画面の方にも同じ内容が表示されていればテストは成功です。</p>
<p class="image-container"><img alt="s064" src="img/4f6e10ac01d935fe.png"></p>
<aside class="special"><p>Googleの場合、開発中のアクションを実行すると、必ず「〜のテストバージョンです」というセリフが最初に流れるようになっています。アクションを申請・公開するとこのセリフは発話されなくなります。</p>
</aside>
<p>はい、これでVoiceflowとGoogleの連携設定が完了し、Voiceflowで開発した内容を、Googleにアップロードしてテストできるようになりました。ほんと、お疲れさまでした！</p>
<p>現時点では、VoiceflowのGoogle Home向けサポートは、Alexa向けに比べるとまだまだ発展途中なこともあって、各プロジェクトの初回連携設定に非常に手間がかかるのですが、設定してしまえば以降はアップロードしてテストするだけですし、Googleの高い音声認識精度や、AlexaにはないGoogle独自の面白い機能もあります。ぜひ活用してみてください。</p>
<p>では引き続きアクションを作成していきましょう。</p>
<h2 is-upgraded>おまけ：Voiceflowのテスト機能</h2>
<p>実は、Google上でテストしなくても、Voiceflowにもテスト機能がありますので、少しご紹介します。</p>
<p>左上にある&#34;Test&#34;をクリックします。</p>
<p class="image-container"><img alt="s065" src="img/86e2f858b136286f.png"></p>
<p>画面が変わりましたね。右上の&#34;Start Test&#34;ボタンをクリックします。</p>
<p class="image-container"><img alt="s066" src="img/c73f0d6c84243d71.png"></p>
<p>右のメニューでアクションが実行されたのがわかるでしょうか。まだSpeak Blockを一つしかおいてないのでテストがすぐに終わってしまいますが、もっとブロックを並べていくと、ユーザとの会話のやり取りを実際に喋りながら（マイクも使えます）のテストもできますし、変数（後ほどご紹介します）の中身を確認しながらテストを行うデバッグモードなんかもあります。</p>
<p class="image-container"><img alt="s067" src="img/696c9b56a9eacb0e.png"></p>
<p>ただし、以下のような注意点があります。</p>
<aside class="warning"><p>Voiceflowのテストで使用される音声は、実際にGoogle Homeがしゃべる音声とは異なり、またイントネーションなども変わります。実際の印象と比べると、かなり印象が変わります。</p>
</aside>
<aside class="warning"><p>実際にGoogle Homeを使う場合とは環境が異なりますので、完全に同じテストができるわけではありません。Voiceflowのテストでは動いたけど、Googleのテストでは動かない、またはその逆、ということもあります。</p>
</aside>
<p>これらの理由から、Voiceflowのテストはあくまでも簡単な動作確認などにとどめて、正確なテストはActons on Google，もしくは、実機で行うようにしてください。</p>
<p>テストを終わる場合は、左上の&#34;Back&#34;をクリックしてください。Canvas画面に戻ります。</p>
<p class="image-container"><img alt="s068" src="img/641749626cbe6205.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="アクションの作成（STEP2）" duration="0">
        <h2 is-upgraded>呼び出し名の設定</h2>
<p>アクションの作成を続けていく前に、先程のテスト、呼び出し名が「テスト用アプリ」になっていましたよね？これじゃ気分が出ないので、アクションの呼び出し名を変えましょう。</p>
<p>アクションの呼び出し名は、Voiceflowでは設定できませんので、Actions on Googleで行います。Voiceflowから一度アップロードを行い、Actions on Googleのテスト画面を開いてください。</p>
<aside class="special"><p>もちろんActions on Googleへ直接アクセスしてもOKです！</p>
</aside>
<p class="image-container"><img alt="s060" src="img/bd06156e280c64d8.png"></p>
<p>テスト画面が開いたら、一番上のメニューの中にある&#34;Develop&#34;をクリックします。</p>
<p class="image-container"><img alt="s201" src="img/db801c3c3ebcdb7a.png"></p>
<p>Invocation（呼び出し）の設定画面が開きます。&#34;Japanese&#34;と&#34;English&#34;が並んでいると思いますので、&#34;Japanese&#34;が選択されている状態で、Display Nameの下にあるフォームに呼び出し名を入力します。今回は「フルーツパーラー」と入力します。入力し終わったら、右上の&#34;Save&#34;をクリックして保存します。</p>
<aside class="warning"><p>呼び出し名は早いもの勝ちです。</p>
</aside>
<aside class="warning"><p>呼び出し名はルールがあります。詳しくは、<a href="https://developers.google.com/actions/policies/general-policies#naming_directory_listing_and_promotion" target="_blank">https://developers.google.com/actions/policies/general-policies#naming_directory_listing_and_promotion</a>をご確認ください。</p>
</aside>
<p class="image-container"><img alt="s202" src="img/4c93653b4c34f999.png"></p>
<p>テストで変わっているか確認してみましょう。一番上のメニューのTestをクリックします。</p>
<p class="image-container"><img alt="s203" src="img/d3ef6d3f62eec3cc.png"></p>
<p>変わってますね！せっかくなのでマイクを使って試してみましょう。マイクのアイコンをクリックします。</p>
<aside class="warning"><p>ブラウザでマイクの利用を許可する必要があります。</p>
</aside>
<p class="image-container"><img alt="s204" src="img/daa93455d98ba95d.png"></p>
<p>マイクが赤く点滅しているときが待受状態になります。Google Homeの場合は、「〜につないで」でアクションが起動しますので、マイクに向かって「フルーツパーラーにつないで」と言ってみてください。</p>
<p class="image-container"><img alt="s205" src="img/4d6a05b34b1094b5.png"></p>
<p>設定した呼び出し名でアクションが起動してますね！</p>
<p class="image-container"><img alt="s206" src="img/9ae5de9dc4f4eb71.png"></p>
<p>これで呼び出し名の変更は完了です。以降のテストでは新しい呼び出し名で呼び出してテストしてください。</p>
<h2 is-upgraded>言語設定の変更</h2>
<p>ついでにもう一つ、Actions on Googleの呼び出し名の設定画面を開いてください。（Actions on Googleの上のメニューの&#34;Develop&#34;をクリックしてください）</p>
<p class="image-container"><img alt="s206-01" src="img/9ba87e8b35831299.png"></p>
<p>呼び出し名の上の&#34;Japanese&#34;の横に&#34;English&#34;も表示されていますね？</p>
<p class="image-container"><img alt="s206-02" src="img/696c1b00c59d3ef0.png"></p>
<p>Actions on Googleでは、１つのアクションで複数の言語に対応しておくと、Google Homeの言語設定に応じてそれぞれの言語で動作するようになっています。ただし、その場合はVoiceflow側でもそれにあわせて作り込む必要がありますし、今回のハンズオンでは対応しません。このまま放置しておいても問題なさそうなのですが、もしアクションを申請・公開される場合、ここの設定も審査される可能性がありますので、対応しないのであれば消しておいたほうがよいでしょう。</p>
<p>対応している言語を設定するには、右端の&#34;Modify languages&#34;をクリックします。</p>
<p class="image-container"><img alt="s206-03" src="img/4a569b5b2f23951c.png"></p>
<p>対応している言語の一覧が表示されます。&#34;Japanese&#34;以外のチェックが入っていればチェックを外してください。</p>
<p class="image-container"><img alt="s206-04" src="img/b21a1001d469100d.png"></p>
<p>右上の&#34;Save&#34;をクリックして保存します。</p>
<p class="image-container"><img alt="s206-05" src="img/51b77f20488cd219.png"></p>
<p>警告画面が表示されます。削除する言語が正しいことを確認して&#34;OK&#34;をクリックします。</p>
<p class="image-container"><img alt="s206-06" src="img/cccc73966b4e688a.png"></p>
<p>はい、これで不要な対応言語の作成が完了しました。</p>
<h2 is-upgraded>ユーザの発話を取得する</h2>
<p>ではアクションの作成を続けていきましょう。</p>
<p>ここまでで、アクションを起動後、「ご注文をどうぞ」とGoogle Homeが聞いてくるところまではできていますので、次はユーザからの発話を取得するところです。</p>
<p class="image-container"><img alt="s207" src="img/13c64e2966dedb38.png"></p>
<p>ユーザからの発話を受け取るためのブロックは複数ありますが、今回は「Interaction Block」を使用します。</p>
<aside class="warning"><p>ユーザからの発話を受け取るためのブロックは、Interaction Blockの他にも、Capture BlockやChoice Blockなどがあります。今回のような複数の選択肢でGoogle Homeからの回答を変えたいような場合は、Choice Blockを使ったほうがシンプルに実現できるのですが、残念ながらChoice Blockには不具合があり、正しく動作しないことがあるため、Interaction Blockを採用しています。（将来的に修正される可能性はあります。）</p>
</aside>
<aside class="special"><p>Interaction Blockのほうが判定精度が高く、より柔軟な会話フローの制御ができるため、今後のスキル開発を進めていく上でもChoice Blockよりおすすめです。</p>
</aside>
<p>BlocksメニューのAdvancedからInteraction Blockを配置しましょう。最初に作ったSpeak Blockの右側に配置して、Speak Blockから線でつなげます。</p>
<p class="image-container"><img alt="s208" src="img/b2ecdb0c33c02ee8.png"></p>
<p>Interaction Blockをクリックすると、右側にInteraction Blockのメニューが表示されます。&#34;Intents&#34;をクリックします。</p>
<p class="image-container"><img alt="s209" src="img/3b43671bdefa4e18.png"></p>
<p>ここから設定を行っていくのですがその前に、VUIをやるにあたっていくつか知っておくべき考え方について説明しておきます。</p>
<h2 is-upgraded>VUIの基本的なコンセプト</h2>
<p>VUIの基本となる重要な考え方として以下の３つがあります。AlexaとGoogleで言い方が違うので少しややこしいかもしれませんが、基本的な考え方は同じなので、そのうち慣れると思います。</p>
<ol type="1">
<li>インテント（Google/Alexa共通）</li>
<li>フレーズ（Googleでの言い方）/サンプル発話（Alexaでの言い方）</li>
<li>エンティティ（Googleでの言い方）/スロット（Alexaでの言い方）</li>
</ol>
<p>ぞれぞれ順に説明していきます。</p>
<aside class="warning"><p><strong>エンティティ/スロットについては、本チャプターでは使用しないため、説明を割愛します。Chapter6で、エンティティを使ってさらにアクションを改善していきますので、その際に説明します。</strong></p>
</aside>
<aside class="warning"><p>なお、Vocieflowでは、Alexaの用語がベースになっているようなので、画面などで出てくる用語はAlexaのものになっていることが多いです。予めご了承下さい。</p>
</aside>
<aside class="special"><p>適宜補足していきますので安心してください！</p>
</aside>
<h3 is-upgraded>インテント</h3>
<p>インテント（&#34;Intent&#34;）を辞書でひいて意味を調べると「意図」や「目的」とあります。VUI/スマートスピーカーにおける「意図」「目的」は何なのか？は、VUI/スマートスピーカーの基本的な使い方を考えるとわかりやすいと思います。</p>
<ol type="1">
<li>ユーザがやりたいこと・やってほしいことをスマートスピーカーに話す。</li>
<li>ユーザが言ったやりたいこと・やってほしいことを解釈して、それにあった適切な回答をスマートスピーカーが返答する。</li>
</ol>
<p>この「ユーザがやりたい・やってほしいと思っていること」、これが「インテント」になります。いくつか例を上げると、</p>
<ul>
<li>お天気インテント：「お天気を教えて」と言うと、「◯◯県の今日の天気は晴れです」と答えてくれる</li>
<li>曲再生インテント：→「○○○の曲をかけて」というと、その曲を再生してくれる</li>
</ul>
<p>という感じになります。では、今回のサンプルの中でユーザがやりたいことってなんでしょうか？</p>
<p class="image-container"><img alt="s011-2" src="img/c4b628a5a0fa113f.png"></p>
<p>はい、「オレンジジュースを注文したい」がインテントになりますね。このインテントに対して、注文をうけて金額を回答するというのが今回作成するアクションになります（実際にオレンジジュースを出すのはスマートスピーカーにはできないので人の手が必要ですが・・・）。</p>
<p>このように、ユーザがやりたい「インテント」を用意して、それに応じた処理を作っていく、というのが、VUI／スマートスピーカーアプリ開発の基本的な流れになりますので、まずはこの考え方に慣れるようにしてくださいね。</p>
<h3 is-upgraded>フレーズ/サンプル発話</h3>
<p>インテントについては理解できたと思います。が、少し考えてみてください。「オレンジジュースを注文したい」というインテントに対して、あなたが実際にお店に行ったとき、どう話しますか？</p>
<ul>
<li>「オレンジジュースをちょうだい」</li>
<li>「オレンジジュースをください」</li>
<li>「オレンジジュースをお願いします」</li>
<li>「オレンジジュースをお願い」</li>
<li>「オレンジジュース」</li>
<li>「オレンジジュースちょうだい」</li>
<li>「オレンジジュースください」</li>
<li>「オレンジジュースお願いします」</li>
<li>「オレンジジュースお願い」</li>
<li>「オレンジジュースで」</li>
</ul>
<p>同じ「インテント」なのにいろんな言い方がありますよね。このように、一つの「インテント」に対して、ユーザが実際に発話するバリエーションのことを「フレーズ」「サンプル発話」といいます。</p>
<p>人間の会話の中では些細な違いですが、コンピュータにとっては１文字違うだけで別のデータになります。GoogleやAmazonは、AIやビッグデータを駆使して、こういったバリエーションの違いなども同じインテントとして正しく理解できるように改善を進めていますが、現時点ではまだまだ完璧ではありません。</p>
<p>そこで、開発者側でこれらのバリエーションを「フレーズ」「サンプル発話」として予め「インテント」と紐付けて、ユーザの様々なバリエーションに広く対応できるようにする必要があります。このバリエーションを多数用意すればするほど、ユーザにとっては「精度が高い」ということになりますので、できるだけ多く登録することをおすすめします。</p>
<aside class="special"><p>GoogleやAmazonでも日々AIの改善は行われていますし、現時点でも細かい違いはある程度よしなに解釈してくれます。</p>
</aside>
<p>Netagiveただし、正しく解釈されるかどうかはやってみないとわからないところもあるので、なるべく多く登録しておくことをおすすめします。</p>
<h3 is-upgraded>エンティティ/スロット</h3>
<p>本チャプターで作成するアクションでは、エンティティ/スロットを扱いませんので、説明を割愛します。次のChapterで、エンティティ/スロットを使って、サンプルスキルを更に改修していきますので、その際に説明します。</p>
<h2 is-upgraded>インテントとサンプル発話の登録</h2>
<p>VUIの基本的な考え方がわかったところで、アクションの作成に戻りましょう。Interaction Blockを配置して、&#34;Intents&#34;のタブを開いたところでしたよね。</p>
<p class="image-container"><img alt="s209" src="img/3b43671bdefa4e18.png"></p>
<p>もうおわかりかと思いますが、ここで「インテント」の設定を行います。初期状態ではインテントが一つもない状態なので、インテントを追加していきましょう。&#34;+ Add Intent&#34;をクリックします。</p>
<p class="image-container"><img alt="s210" src="img/2991814c30eeeba9.png"></p>
<p>インテントの設定項目が出てきます。ではインテントを作成していきます。</p>
<p class="image-container"><img alt="s211" src="img/41f8390e755d1066.png"></p>
<p>ハンズオンの最初に、今回作成するアクションの要件を以下のように決めていました。</p>
<pre><code>・注文できる飲み物は、オレンジジュース、ミックスジュース、アップルジュースの３種類とします。
</code></pre>
<p>つまり、今回のインテントは、以下の３つを作成していくことになりますね。</p>
<ul>
<li>オレンジジュースを注文する</li>
<li>ミックスジュースを注文する</li>
<li>アップルジュースを注文する</li>
</ul>
<p>では、順にやっていきます。まず「インテント名」をつけます。&#34;intent_one&#34;と書いてあるところを&#34;orange_intent&#34;と変更してください。</p>
<p class="image-container"><img alt="s212" src="img/87d576099f9c161d.png"></p>
<p>さらに、インテントに紐づくフレーズを入力していきます。&#34;Enter user reply&#34;と書いてある入力欄に、オレンジジュースを注文するときにユーザが言いそうな発話例を入力していきます。「オレンジジュースをちょうだい」と入力して、ENTERを押すと・・・</p>
<p class="image-container"><img alt="s213" src="img/177318adf1487085.png"></p>
<p>はい、orange_intentにフレーズが登録されました。</p>
<p class="image-container"><img alt="s214" src="img/fdb0fe6292486dce.png"></p>
<p>フレーズをたくさん登録すると様々なユーザの発話バリエーションに対応できるのでしたよね。同じ要領で、続けて以下のサンプル発話も登録してみてください。</p>
<pre><code>オレンジジュースをください
オレンジジュースをお願いします
オレンジジュースをお願い
オレンジジュース
</code></pre>
<p>もっとたくさん登録できますが、とりあえず５つほどにしておきましょう。最終的にはこんな感じになります。</p>
<p class="image-container"><img alt="s215" src="img/8bb7b4cd9bdeec83.png"></p>
<p>続けて、ミックスジュースを注文するインテントです。今登録したorange_intentの上の&#34;+ Add Intent&#34;をもう一度クリックします。</p>
<p class="image-container"><img alt="s216" src="img/f2b7249124e23b59.png"></p>
<p>最初に&#34;+ Add Intent&#34;を追加したときと同じように、インテントの設定項目が出てきます。あとはわかりますよね？？？</p>
<p class="image-container"><img alt="s217" src="img/b457239d6357b686.png"></p>
<p>以下のように設定してみてください。</p>
<h4 is-upgraded>インテント名</h4>
<pre><code>mix_intent
</code></pre>
<h4 is-upgraded>フレーズ</h4>
<pre><code>ミックスジュースをちょうだい
ミックスジュースをください
ミックスジュースをお願いします
ミックスジュースをお願い
ミックスジュース
</code></pre>
<p>こんな感じになればOKです。</p>
<p class="image-container"><img alt="s218" src="img/2c30d0906cb57207.png"></p>
<p>更にアップルジュース用のインテントを追加します。もうやり方は分かりますよね？ここは説明しません。下にコピペ用のテキストを用意しておきますので、各自でやってみてください!</p>
<h4 is-upgraded>インテント名</h4>
<pre><code>apple_intent
</code></pre>
<h4 is-upgraded>フレーズ</h4>
<pre><code>アップルジュースをちょうだい
アップルジュースをください
アップルジュースをお願いします
アップルジュースをお願い
アップルジュース
</code></pre>
<p>最終的に３つのインテントを登録するとこんな感じになります。どうでしょうか？同じになっていますか？</p>
<p class="image-container"><img alt="s219" src="img/e063585b84037bac.png"></p>
<p>これで、インテントとフレーズの設定が終わりました。フレーズに登録された発話をユーザが行うと、それぞれのインテントに紐付けられますので、次はこれをインテントごとに分岐させて会話フローを作っていきます。&#34;Choices&#34;タブをクリックしてください。</p>
<p class="image-container"><img alt="s220" src="img/5ff9ad869527fd63.png"></p>
<p>&#34;Choices&#34;タブでは、各インテントごとの会話フローの「分岐（Choice）」を作成します。&#34;+ Add Choice&#34;をクリックしてみてください。</p>
<p class="image-container"><img alt="s221" src="img/853ec7ee4b2bc2c6.png"></p>
<p>Interaction Blockに&#34;1&#34;というグレーの四角が追加されたのがわかりますか？このBlockにあるグレーの四角同士をつなげることで会話のフローを作っていくのでしたよね。つまりこれでまずブロックを繋げていくための「分岐」が作成されたことになります。</p>
<p class="image-container"><img alt="s222" src="img/6e127f20a2dd8890.png"></p>
<p>さらに、右のメニューでは、その番号にマッチした数字とインテントを選択するためのドロップダウンリストが表示されています。ここでインテントを選択することで、インテントごとに分岐する会話フローができるというわけですね！</p>
<p class="image-container"><img alt="s223" src="img/37af8919ad892618.png"></p>
<p>さっそくインテントを設定しましょう。ドロップダウンリストから、&#34;orange_intent&#34;を選択してください。</p>
<p class="image-container"><img alt="s224" src="img/cf3e4240710a3b11.png"></p>
<p>同じように、&#34;+ Add Choice&#34;をクリックして、それぞれにインテントを選択していきます。最終的にはこうなればOKです。</p>
<p class="image-container"><img alt="s225" src="img/edaf30d7af8a1465.png"></p>
<p>それぞれの分岐は以下のようになります。</p>
<ol type="1">
<li>オレンジジュースを注文した場合</li>
<li>ミックスジュースを注文した場合</li>
<li>アップルジュースを注文した場合</li>
</ol>
<p>あとは、それぞれの分岐に応じた、発話を用意すればOKですね！Speak Blockを3つドラッグ＆ドロップで配置して、Interaction Blockの各分岐とつなげてみてください。</p>
<p class="image-container"><img alt="s226" src="img/9c9e2c29c32f747b.png"></p>
<p>続けて、それぞれのSpeak Blockをクリックして、Google Homeからの発話内容を入力していきます。Interaction Blockで設定したそれぞれのインテントにあった内容になるように入力してください。</p>
<h4 is-upgraded>1. オレンジジュースを注文した場合</h4>
<pre><code>オレンジジュースですね。350円になります。ありがとうございました。
</code></pre>
<p class="image-container"><img alt="s227-01" src="img/1b7bd2f6843f8de2.png"></p>
<h4 is-upgraded>2. ミックスジュースを注文した場合</h4>
<pre><code>ミックスジュースですね。450円になります。ありがとうございました。
</code></pre>
<p class="image-container"><img alt="s227-02" src="img/a1c5420236473f1d.png"></p>
<h4 is-upgraded>3. アップルジュースを注文した場合</h4>
<pre><code>アップルジュースですね。400円になります。ありがとうございました。
</code></pre>
<p class="image-container"><img alt="s227-03" src="img/72ad2747641501b.png"></p>
<p>はい、これで、今回のサンプルアクションが最初に想定していた内容はすべて完了しました！おつかれさまでした！</p>
<h2 is-upgraded>想定していない発話の場合</h2>
<p>・・・と言いたいところですが、もう一つだけ、やっておくべきことがあります。</p>
<p>今回のアクションでは、以下の注文を受け付けることができますよね。</p>
<ul>
<li>オレンジジュース</li>
<li>ミックスジュース</li>
<li>アップルジュース</li>
</ul>
<p>もし用意していないメニューを言われた場合、どうなるでしょうか？実際のお店でもそういうことってありますよね？そういう「想定外」の発話を受け取った場合の処理も予め用意しておく必要があります。Interaction Blockを見てください。</p>
<p class="image-container"><img alt="s228" src="img/9506dda2e21e5dcc.png"></p>
<p>一つだけ「Else」と書かれた分岐だけどこにもつながっていないですよね？この「Else」が、どのインテントにも合致しない発話が行われた場合に分岐する会話フローとなっているのです。したがって、ここからSpeak Blockにつなげて、「あいにく取り扱っておりません」というような発話をさせればよいというわけです。早速やってみましょう。</p>
<p>Speak Blockをおいて、Interaction Blockの&#34;Else&#34;から線でつなげてください。</p>
<p class="image-container"><img alt="s229" src="img/53865087b802dfee.png"></p>
<p>そしてSpeak Blockに以下の内容を入力します。</p>
<pre><code>申し訳ありません、よくわかりませんでした。ご注文は、オレンジジュース、ミックスジュース、アップルジュースから選んでいただけますか？ご注文をどうぞ。
</code></pre>
<p>こんな感じになります。</p>
<p class="image-container"><img alt="s230" src="img/4a1cab3e59c71ab6.png"></p>
<p>さらにSpeak BlockからInteraction Blockに線をつなげます。これで想定していない場合は、受付できる注文を説明して、ユーザを想定している注文に誘導しつつ、再度ユーザからの注文を受け付けることができるわけですね。</p>
<p class="image-container"><img alt="s231" src="img/455e7a65504e1e95.png"></p>
<p>はい、これで、本当に今回のサンプルアクションの作成はは完了です！テストして正しくどうするかを確認してみましょう！</p>
<h2 is-upgraded>テスト</h2>
<p>では、アップロードして、Actions on Googleのシミュレータを開いて、テストしてみてください。正しく動作するでしょうか？</p>
<p class="image-container"><img alt="s060" src="img/bd06156e280c64d8.png"></p>
<p class="image-container"><img alt="s232" src="img/df014cd164703fcd.png"></p>
<p>想定していない場合はもう一度聞き直して、想定しているものはちゃんと回答ができていますね！実機でも確認できますので、ぜひ試してみてください！</p>
<p>これでサンプルスキルの作成は完了です！ほんとうにお疲れさまでした！</p>
<h2 is-upgraded>おまけ：Google Homeの音声を変える</h2>
<p>デフォルトだと、Google Homeから流れてくる声は少し高めの女性の声になっていると思いますが、実はこの声を変更することができます！</p>
<p>声の変更は、Actions on Googleで行います。Voiceflowから一度アップロードを行い、Actions on Googleのテスト画面を開いてください。</p>
<p class="image-container"><img alt="s060" src="img/bd06156e280c64d8.png"></p>
<p>テスト画面が開いたら、一番上のメニューの中にある&#34;Develop&#34;をクリックします。</p>
<p class="image-container"><img alt="s201" src="img/db801c3c3ebcdb7a.png"></p>
<p>Invocation（呼び出し）の設定画面が開きます。下の方にあるGoogle Assistant voiceをみてください。</p>
<p class="image-container"><img alt="s233" src="img/123ac8143f57c60.png"></p>
<p>デフォルトでは&#34;Female 1&#34;が選択されていると思います。つまり、女性の声ですね。ドロップダウンリストを開くと、女性の声がもう１パターン（Female 2）とあと男性の声が２パターン（Male 1/Make 2）用意されていますので、どれか選択します。</p>
<p class="image-container"><img alt="s234" src="img/c082738642831f52.png"></p>
<p>最後に右上の&#34;Save&#34;をクリックして、保存してください</p>
<p class="image-container"><img alt="s235" src="img/f594cac8a74c6732.png"></p>
<p>再度、上のメニューから&#34;Test&#34;をクリックして、シミュレータを開きテストしてみてください。どういう声になるかは実際にやってみてのお楽しみです！</p>
<p class="image-container"><img alt="s236" src="img/4d471b939e67653d.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="アクションの改善(STEP1)" duration="0">
        <p>この章では、ここまで作ったアクションをいろいろな方法で改善していきましょう。</p>
<h2 is-upgraded>サウンドを使う その1(mp3ファイルのアップロード)</h2>
<p>ここまででGoogle Homeとの会話ができるようになりましたけど、会話だけだとちょっとなんか寂しいですよね。そういうときは効果音を使うことで、かんたんに楽しい感じにすることができます。</p>
<p>効果音の使い方には色んな方法があります。</p>
<ul>
<li>mp3ファイルをVoiceflowにアップロードする</li>
<li>アップロードされたmp3ファイルをURLで参照する</li>
<li>SSMLとサウンドライブラリを使う</li>
</ul>
<p>ここでは一番かんたんなmp3ファイルアップロードをやってみましょう。</p>
<p>今回は、「<a href="https://soundeffect-lab.info/" target="_blank">効果音ラボ</a>」様の以下のものを利用させていただきましょう。以下のリンクをクリックして、それぞれのリンク先でDLボタンをクリックしてファイルをダウンロードしてください。</p>
<ul>
<li><a href="https://soundeffect-lab.info/sound/search.php?searchtext=%E5%85%A5%E5%BA%97%E3%83%81%E3%83%A3%E3%82%A4%E3%83%A0&x=0&y=0" target="_blank">入店チャイム(shop-chime1.mp3)</a></li>
<li><a href="https://soundeffect-lab.info/sound/search.php?searchtext=%E6%B0%B4%E3%82%92%E6%B3%A8%E3%81%90&x=0&y=0" target="_blank">グラスに水を注ぐ(glass-water1.mp3)</a></li>
<li><a href="https://soundeffect-lab.info/sound/search.php?searchtext=%E3%83%AC%E3%82%B8%E3%82%B9%E3%82%BF%E3%83%BC&x=0&y=0" target="_blank">レジスターで精算(clearing1.mp3)</a></li>
</ul>
<aside class="warning"><p>素材配布サイトの効果音等を利用する場合、必ず配布元の利用規約を確認の上、ご利用してください。</p>
</aside>
<p>では、アクションにアップロードしていきます。まず、「入店チャイム(shop-chime1.mp3)」からです。Home Block直後のSpeak Blockをクリックします。</p>
<p class="image-container"><img alt="s301" src="img/1e52196905507250.png"></p>
<p>Speak Blockのメニューが右に表示されたら、&#34;Add Audio&#34;をクリックします。</p>
<p class="image-container"><img alt="s302" src="img/de2bf443c38e1bf3.png"></p>
<p>発話内容が入力されている箇所の下にAudioという欄が追加されます。&#34;Drag and Drop files here&#34;と書いてあるので、ここに先程のmp3ファイルをドラッグアンドドロップします。</p>
<p class="image-container"><img alt="s303" src="img/a27c8394a06e3bbb.png"></p>
<p>アップロードされました。これで完了です。かんたんですね！再生ボタンを押すとその場で再生されます。</p>
<p class="image-container"><img alt="s304" src="img/959ab0c7faf21d67.png"></p>
<p>これで、最初に「フルーツパーラーへようこそ・・・」と発話されて、その後、「入店チャイム」が再生されるというわけですが、先に入店チャイムが再生されるのが普通ですよね？ということで、Speak Blockの中での発話やオーディオの順番を入れ替えることもできます。音符アイコンとmp3ファイル名のあたりをドラッグして、「フルーツパーラーへ・・・」の発話よりも上にドロップしてみてください。</p>
<p class="image-container"><img alt="s305" src="img/caf12d4b7deade56.png"></p>
<p>はい、入れ替わりました。これもかんたんですね。</p>
<p class="image-container"><img alt="s306" src="img/24fe1ed36e59e5f3.png"></p>
<p>はい、ではこれでアップロードしてテストしてみましょう。</p>
<p class="image-container"><img alt="s307" src="img/bd06156e280c64d8.png"></p>
<p>残念ながら、これは画面ではわからないので、ぜひご自身でテストして試してみてください！</p>
<p class="image-container"><img alt="s308" src="img/91d3101bcc11b232.png"></p>
<p>同様にして、「グラスに水を注ぐ」「レジスターで精算」も追加してみましょう。ここは少し発話もいじってみましょう。</p>
<p>オレンジジュースを注文したあとのSpeak Blockをクリックします。</p>
<p class="image-container"><img alt="s309" src="img/b21c2281bd1edc61.png"></p>
<p>発話内容を以下に変更してください。</p>
<pre><code>オレンジジュースですね。少々お待ち下さい。
</code></pre>
<p class="image-container"><img alt="s310" src="img/37fb7d6e351282aa.png"></p>
<p>次に、&#34;Add Audio&#34;をクリックして、先程と同様のやり方で、今度は「グラスに水を注ぐ(glass-water1.mp3)」をアップロードします。</p>
<p class="image-container"><img alt="s311" src="img/b6e4bb3f72170ea6.png"></p>
<p>mp3ファイルがアップロードされました。さらに今度は&#34;Add Speech&#34;をクリックします。</p>
<p class="image-container"><img alt="s312" src="img/52eb908bb4e1e6a9.png"></p>
<p>&#34;Add Audio&#34;の場合は、Speak Blockにmp3ファイルを追加しますが、&#34;Add Speech&#34;の場合は発話を追加することになります。このようにして、発話と効果音を交互に続けたりすることができるんですね。</p>
<p class="image-container"><img alt="s313" src="img/1dcf209fea2e90a6.png"></p>
<p>では、追加した発話の入力欄に以下の設定してください。</p>
<pre><code>お待たせいたしました。オレンジジュースです。お会計は、350円になります。
</code></pre>
<p class="image-container"><img alt="s314" src="img/5e35bf1eeafc12b7.png"></p>
<p>さらに&#34;Add Audio&#34;で今度は「レジスターで精算(clearing1.mp3)」をアップロードします。</p>
<p class="image-container"><img alt="s315" src="img/2dd5831c33882ef0.png"></p>
<p>最後にもう一度&#34;Add Speech&#34;で、以下を入力します。</p>
<pre><code>ありがとうございました。
</code></pre>
<p class="image-container"><img alt="s316" src="img/643364a809b57a07.png"></p>
<p>最終的には、ちょっと長くなりましたけど、こんな形になります。</p>
<p class="image-container"><img alt="s317" src="img/479813f59df0153e.png"></p>
<p>テストして試してみてください。想定通りになっているでしょうか？</p>
<p>あとはこれをミックスジュースとアップルジュースでも繰り返して設定し直せばよいのですが、ちょっとめんどくさいと思いませんか・・・？</p>
<p>ということで、少し楽をするやり方を次にご紹介します。</p>
<h2 is-upgraded>ブロックのコピーとペースト</h2>
<p>Voiceflowでは設定したブロックをコピー＆ペーストで複製することができます。先程修正したオレンジジュースのSpeak Blockと同様にミックスジュースとアップルジュースのSpeak Blockをそれぞれ修正してもいいんですけど、Speak Blockをコピーして、ジュースの名前と金額だけを変えたほうが早いですよね。</p>
<p>ということでやってみましょう。</p>
<p>まず、ミックスジュースとアップルジュースのSpeak Blockを思い切って消しちゃいます。それぞれクリックしたあとにDELETEキーを押してみてください。</p>
<p class="image-container"><img alt="s318" src="img/89ea33d56527b98c.png"></p>
<p>はい、消えました！</p>
<p class="image-container"><img alt="s319" src="img/ddff11781fae5d4b.png"></p>
<p>もう一つ別のやり方。SHIFTキーを押しながらドラッグすることで範囲選択することもできます。この場合は複数選択も可能です。選択後、DELETEキーを押します。</p>
<p class="image-container"><img alt="s320" src="img/882b737c0993b81b.png"></p>
<p>さらに消えました！</p>
<p class="image-container"><img alt="s321" src="img/40829cabe5271ab6.png"></p>
<p>はい、ではオレンジジュースのSpeak Blockを選択してCTRL+Cでコピーしてみてください。</p>
<p class="image-container"><img alt="s322" src="img/dd435d1f7ff7b2c0.png"></p>
<p>こんな感じのメッセージが表示されれば、ブロックがコピーされています。</p>
<p class="image-container"><img alt="s323" src="img/d4af65f626d536e3.png"></p>
<p>ということで、置きたい位置を一度クリックしてからCTRL+Vすると、だいたいそのあたりにペーストされます。</p>
<p class="image-container"><img alt="s324" src="img/b0ad4dd056b853a5.png"></p>
<p>同じように、もう一つペーストして、位置を調整して線をつなぎます。</p>
<p>ただし、中身はすべてコピー元の「オレンジジュース」の内容になっているので、それぞれクリックして、内容を修正します。</p>
<p class="image-container"><img alt="s325" src="img/2a25c080d47e7b9.png"></p>
<p>全部で6箇所あるはずです。テキストの修正だけなので楽ちんですね！終わったらきちんとアップロードしてテストしておいてください。</p>
<h2 is-upgraded>サウンドを使う その2（サウンドライブラリとSSML）</h2>
<p>少し話を戻して、サウンドを使う別の方法をご紹介します。先程はmp3ファイルそのものをアップロードしてもらいましたが、実はGoogleですでに用意された効果音のライブラリがあります。それが「サウンドライブラリ」です。</p>
<p><a href="https://developers.google.com/actions/tools/sound-library/" target="_blank">https://developers.google.com/actions/tools/sound-library/</a></p>
<p class="image-container"><img alt="s325" src="img/2a25c080d47e7b9.png"></p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
